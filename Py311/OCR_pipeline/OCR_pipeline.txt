# ğŸ“¦ **requirements.txt**

This includes only the packages pipeline actually uses â€” no bloat, no duplicates.

```
numpy
pillow
opencv-python-headless
onnxruntime
paddleocr
easyocr
scikit-learn
pdfplumber
pymupdf
pdf2image
huggingface_hub
matplotlib
```

---

# ğŸ“˜ **README.md**

```
# Advanced OCR Pipeline (DBNet + PaddleOCR + EasyOCR + XY-Cut Layout Engine)

This project implements a full document OCR pipeline combining:

- DBNet (ONNX) for text region detection  
- EasyOCR word recognition  
- XY-cut zone detection  
- Multi-column layout reconstruction  
- Baseline-aware line grouping  
- Paragraph merging  
- Caption and list-item detection  
- Debug overlays and paragraph overlays  
- Natural reading order extraction  

The pipeline supports both **PDFs** and **image files**.

---

ğŸ§° ADVANCED OCR PIPELINE â€” COMPLETE INSTALLATION GUIDE (WINDOWS)
ğŸ—‚ï¸ 1. Folder Structure (Recommended)
Create a working directory like:
D:\Omat\ocr_project\
â”‚
â”œâ”€â”€ advanced_ocr_pipeline.py
â”œâ”€â”€ paddleocr_onnx\
â”œâ”€â”€ input\
â””â”€â”€ output\
You can name things differently, but this structure keeps everything clean.

ğŸ 2. Install Python (3.10 or 3.11 recommended)
Download from:
https://www.python.org/downloads/
During installation:
    â€¢ âœ” Check â€œAdd Python to PATHâ€ 
    â€¢ âœ” Choose Customize installation 
    â€¢ âœ” Enable pip, venv, tcl/tk, dev tools 

ğŸ§ª 3. Create a Virtual Environment
Open PowerShell or cmd:
cd D:\Omat\ocr_project
python -m venv venv
Activate it:
venv\Scripts\activate
Prompt should now show (venv).

ğŸ“¦ 4. Install Required Python Packages
Install dependencies:
â­ The ONLY Paddle version that works with PaddleX on Python 3.11 is:
paddlepaddle==3.0.0
(the PyPI shim that still uses the old executor)
Everything else must be installed after that.
Below is the exact, correct, stable install order for a brandâ€‘new venv.

âœ… THE DEFINITIVE INSTALL ORDER FOR YOUR OCR PIPELINE (Python 3.11)
This is the sequence that will reproduce working environment exactly.
Run these in this order, inside your new venv:

1) Upgrade pip
python -m pip install --upgrade pip OR
pip install --upgrade pip wheel setuptools

2) Install core PDF + image dependencies
pip install pdfplumber
pip install pymupdf          # provides "fitz"
pip install pdf2image
pip install opencv-python
pip install onnxruntime
pip install scikit-learn
pip install symspellpy

3) Install PaddlePaddle first (critical)
This must be installed before PaddleX or PaddleOCR.
pip install paddlepaddle==3.0.0 --force-reinstall
Why?
Because PaddleX 3.3.x only works with the old executor inside this shim.

4) Install PaddleX
pip install paddlex==3.3.12 --force-reinstall
This version is compatible with PaddlePaddle 3.0.0 (shim).

5) Install PaddleOCR
pip install paddleocr==3.3.3 --force-reinstall
This version is compatible with PaddleX 3.3.12 and PaddlePaddle 3.0.0.

6) Install EasyOCR
pip install easyocr
EasyOCR is independent of Paddle and wonâ€™t interfere.

ğŸ¯ At this point, Paddle stack is correct and stable.
Now install the remaining utilities:

7) Install everything else you use

ğŸ§ª Verify Paddle is correct
Run:
python -c "import paddle, inspect; print(paddle.__version__); print(inspect.getfile(paddle))"
Expected output:
3.0.0
.../OCR_pipeline/venv311/Lib/site-packages/paddle/__init__.py
If the path points outside the venv, something contaminated the environment.

ğŸ§± Why this order works
Because:
    â€¢ PaddleX must be installed after PaddlePaddle 
    â€¢ PaddleOCR must be installed after PaddlePaddle 
    â€¢ PaddlePaddle must be the 3.0.0 shim, not the real 3.3.x 
    â€¢ EasyOCR must be installed after everything else 
    â€¢ PDF/image libs must be installed before OCR engines 
    â€¢ Installing Paddle last will break PaddleX 
    â€¢ Installing PaddleOCR first will break PaddleX 
    â€¢ Installing PaddlePaddle 3.3.x will break everything 
This sequence avoids all of that.


ğŸ–¼ï¸ 5. Install Poppler (Required for pdf2image)
Poppler is needed to render PDF pages into PNGs.
Download Windows build:
https://github.com/oschwartz10612/poppler-windows/releases/ (github.com in Bing)
Choose the latest popplerâ€‘xx.x.xâ€‘Releaseâ€‘x64.zip.
Extract it somewhere stable, e.g.:
C:\Tools\poppler\
Inside script, set:
POPPLER_BIN = r"C:\Tools\poppler\Library\bin"
Make sure the path points to the folder containing:
pdftoppm.exe
pdftocairo.exe

ğŸ¤– 6. Download ONNX Models (DBNet + CRNN)
Script already includes:
from huggingface_hub import snapshot_download

snapshot_download(
    repo_id="marsena/paddleocr-onnx-models",
    local_dir="./paddleocr_onnx"
)
Run this once:
python
>>> from huggingface_hub import snapshot_download
>>> snapshot_download("marsena/paddleocr-onnx-models", local_dir="paddleocr_onnx")
You should now have:
paddleocr_onnx/
    PP-OCRv5_server_det_infer.onnx
    PP-OCRv5_server_rec_infer.onnx
    ...
These are the DBNet detector + CRNN recognizer.

ğŸ§© 7. Verify ONNX Model Paths in the Script
Script uses:
CRNN_MODEL_PATH = "paddleocr_onnx/PP-OCRv5_server_rec_infer.onnx"
Make sure the filenames match exactly.

ğŸ“ 8. Prepare Input and Output Folders
Set these in your script:
INPUT_ROOT = r"D:\Omat\ocr_test"
OUTPUT_ROOT = r"D:\Omat\ocr_output"
Create the folders:
D:\Omat\ocr_test\
D:\Omat\ocr_output\
Put PDFs or images into ocr_test.

â–¶ï¸ 9. Run the Pipeline
Activate your venv:
cd D:\Omat\ocr_project
venv\Scripts\activate
Run:
python advanced_ocr_pipeline.py
The script will:
    â€¢ scan INPUT_ROOT 
    â€¢ process each file 
    â€¢ write results to OUTPUT_ROOT/<filename>/ 

ğŸ“¦ 10. Output Files You Will Get (OLD)
For each file:
<OUTPUT_ROOT>/<file_stem>/
â”‚
â”œâ”€â”€ page_1.png
â”œâ”€â”€ page_1_overlay.png
â”œâ”€â”€ page_1_paragraphs.png
â”‚
â”œâ”€â”€ embedded_images/
â”œâ”€â”€ tables/
â”‚
â”œâ”€â”€ text.txt
â”œâ”€â”€ natural_reading_order/
â”‚   â””â”€â”€ text.txt
â”‚
â””â”€â”€ layout.json
layout.json includes:
    â€¢ all regions (words + paragraphs) 
    â€¢ zones 
    â€¢ columns 
    â€¢ captions 
    â€¢ list items 
    â€¢ overlays 

ğŸ§ª 11. Test the Installation (OLD)
Try a simple PDF:
D:\Omat\ocr_test\sample.pdf
Run:
python advanced_ocr_pipeline.py
Check:
    â€¢ page_1.png exists 
    â€¢ page_1_overlay.png shows colored boxes 
    â€¢ text.txt contains extracted text 
    â€¢ layout.json contains zones, paragraphs, etc. 

ğŸ› ï¸ 12. Troubleshooting
â— Poppler not found
Check:
POPPLER_BIN = r"C:\Tools\poppler\Library\bin"
â— ONNXRuntime errors
Make sure:
pip install onnxruntime
â— EasyOCR missing model files
EasyOCR downloads models on first run.
If blocked by firewall, manually download:
~/.EasyOCR/model/
â— DBNet returns 0 boxes
Check that the ONNX models are in the correct folder.

ğŸ‰ Youâ€™re Fully Set Up
You now have:
    â€¢ a complete OCR engine 
    â€¢ DBNet + CRNN ONNX models 
    â€¢ PaddleOCR + EasyOCR hybrid recognition 
    â€¢ XYâ€‘cut zone detection 
    â€¢ multiâ€‘column support 
    â€¢ paragraph reconstruction 
    â€¢ caption/list detection 
    â€¢ debug overlays 
    â€¢ natural reading order extraction 
---

## ğŸ“œ License

This project is provided as-is for research and personal use.
```


